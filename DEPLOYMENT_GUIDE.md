# Deployment Guide - Online Multiplayer Bingo

## Quick Start for Testing Locally

1. **Install dependencies:**
```bash
npm install
```

2. **Set up database:**
```bash
# Update .env with your PostgreSQL connection
cp .env.example .env

# Run migrations
npm run db:push
```

3. **Start servers:**
```bash
# Terminal 1: Backend
npm run dev

# Terminal 2: Frontend
npm run dev:client
```

4. **Open browser:**
```
http://localhost:5000
```

---

## Production Deployment (Recommended)

### Architecture
- **Frontend**: Vercel (static React app)
- **Backend**: Railway (Node.js + WebSocket)
- **Database**: Railway PostgreSQL

### Why This Setup?
- Railway provides persistent Node.js server (not serverless)
- True WebSocket support (not polling fallback)
- No timeout limits for auto-call feature
- Built-in PostgreSQL database

---

## Step 1: Deploy Backend to Railway

1. **Create Railway account**: https://railway.app
2. **Create new project** → Select PostgreSQL template
3. **Add your GitHub repository**
4. **Configure environment variables** in Railway dashboard:
   ```
   DATABASE_URL (auto-generated by Railway)
   CLIENT_URL=https://your-app.vercel.app (update after Vercel deploy)
   PORT=3000
   NODE_ENV=production
   ```
5. **Railway will auto-deploy** from your main branch
6. **Copy your Railway backend URL** (e.g., `https://bingo-production.up.railway.app`)

### Railway Configuration
Railway should auto-detect your `railway.json`:
```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "cd server && npm install && npm run build"
  },
  "deploy": {
    "startCommand": "cd server && npm start",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

---

## Step 2: Deploy Frontend to Vercel

1. **Create Vercel account**: https://vercel.com
2. **Import your GitHub repository**
3. **Configure build settings**:
   - Framework Preset: Vite
   - Root Directory: `.` (project root)
   - Build Command: `npm run build`
   - Output Directory: `dist/public`
4. **Add environment variable**:
   ```
   VITE_API_URL=https://your-backend.railway.app
   ```
5. **Deploy**
6. **Copy your Vercel URL** (e.g., `https://bingo-game.vercel.app`)

### Update Backend CLIENT_URL
Go back to Railway and update `CLIENT_URL` to your Vercel URL.

---

## Step 3: Run Database Migration

After first deployment, run migrations:

```bash
# Connect to your Railway PostgreSQL
DATABASE_URL="your-railway-database-url" npm run db:push
```

Or use Railway CLI:
```bash
railway run npm run db:push
```

---

## Environment Variables Summary

### Backend (Railway)
```env
DATABASE_URL=postgresql://... (auto-generated)
CLIENT_URL=https://your-app.vercel.app
PORT=3000
NODE_ENV=production
```

### Frontend (Vercel)
```env
VITE_API_URL=https://your-backend.railway.app
```

---

## Verify Deployment

1. **Test WebSocket connection**:
   - Open browser console
   - Look for "Socket.IO connected" message
   - Connection status indicator should show green

2. **Test game creation**:
   - Create a game as host
   - Copy game link
   - Open in incognito/different browser
   - Join as player
   - Verify real-time updates

3. **Test auto-call**:
   - Start game as host
   - Enable auto-call
   - Verify numbers appear every X seconds

---

## Troubleshooting

### WebSocket Not Connecting
- Check CORS is configured in backend
- Verify `CLIENT_URL` matches your Vercel URL exactly
- Check Railway logs for errors
- Ensure using WSS (https) in production

### Database Connection Failed
- Verify `DATABASE_URL` is correct
- Check Railway PostgreSQL service is running
- Run migrations: `npm run db:push`

### Cards Not Saving
- Check `cards` table exists in database
- Verify `/api/games/:gameId/cards` endpoint works
- Check server logs for database errors

### Auto-Call Not Working
- Verify game status is "playing"
- Check backend logs for auto-caller errors
- Ensure Railway container doesn't restart during auto-call

---

## Monitoring

### Railway Dashboard
- View real-time logs
- Monitor CPU/memory usage
- Set up alerts for crashes

### Vercel Dashboard
- View deployment logs
- Monitor build status
- Check function invocation (if using serverless)

---

## Scaling Considerations

### When You Need More Performance:
1. **Upgrade Railway plan** for more resources
2. **Add Redis** for session management
3. **Use PM2** for process management
4. **Enable compression** on backend
5. **CDN** for static assets

### Current Limits (Free Tier):
- Railway: $5/month credit, ~500 hours
- Vercel: Unlimited deployments, 100GB bandwidth
- PostgreSQL: 1GB storage, 1M rows

---

## Security Checklist

- [✅] CORS configured correctly
- [✅] Environment variables not committed
- [✅] Database credentials secure
- [✅] HTTPS enforced in production
- [⚠️] Developer mode has no auth (intentional trust model)

---

## Backup Strategy

### Database Backups:
Railway provides automatic daily backups on paid plans.

For manual backup:
```bash
pg_dump $DATABASE_URL > backup.sql
```

### Restore:
```bash
psql $DATABASE_URL < backup.sql
```

---

## CI/CD (Optional)

Railway and Vercel auto-deploy on git push. No additional CI/CD needed.

For custom workflow:
1. Create GitHub Actions workflow
2. Run tests before deploy
3. Deploy on successful build

---

## Cost Estimate (Monthly)

### Free Tier:
- Vercel: $0
- Railway: $5 credit (free)
- **Total: $0**

### Light Usage (~100 games/month):
- Vercel: $0
- Railway: ~$5-10
- **Total: ~$5-10/month**

### Heavy Usage (~1000 games/month):
- Vercel: $0-20
- Railway: ~$20-30
- **Total: ~$20-50/month**

---

## Support

### Getting Help:
1. Check IMPLEMENTATION.md for feature docs
2. Check Railway/Vercel documentation
3. Review server logs for errors
4. Open GitHub issue

### Common Questions:

**Q: Can I use Vercel for both frontend and backend?**
A: Not recommended. Vercel serverless has 10s timeout and WebSocket limitations.

**Q: Can I use Heroku instead of Railway?**
A: Yes! Similar setup. Add Heroku Postgres addon.

**Q: Do I need a custom domain?**
A: No, Railway and Vercel provide free domains.

---

## Next Steps After Deployment

1. Test all features in production
2. Share game link with friends
3. Monitor performance
4. Set up custom domain (optional)
5. Add analytics (optional)
6. Configure alerts (optional)

---

**Deployment Status: ✅ Ready for Production**

The application is fully configured for deployment and ready to handle real-time multiplayer bingo games!
